name: Intergration Test

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master
jobs: 
  run-full-sync:
    runs-on: [self-hosted, linux, x64]
    timeout-minutes: 4320
    steps:
    - name: Install latest nightly
      uses: actions-rs/toolchain@v1
      with:
          toolchain: nightly
          override: true
          components: rustfmt, clippy
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Build
      run: ./make.sh build
    - name: run
      run: |
      ./src/defid -daemon -datadir="./defi"
    - name: Wait for node
      run: |
        sleep 20
        DEFIDATADIR=~/.defi
        cargo run --manifest-path="./ci/node-monitor/Cargo.toml" --release -- --config="./defi/defi.conf"